@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@model IEnumerable<Pipelights.Website.BusinessService.Models.ProductDetailsDto>


@{
    ViewData["Title"] = "Corpuri de iluminat in stil industrial by SeRox";
}
<style>
    .sidenav {
        height: 100%;
        width: 0;
        position: fixed;
        z-index: 90000;
        top: 0;
        left: 0;
        background-color: #f6f6f6;
        overflow-x: hidden;
        transition: 0.5s;
        padding-top: 60px;
    }

        .sidenav a {
            padding: 8px 8px 8px 32px;
            text-decoration: none;
            font-size: 18px;
            color: #818181;
            display: block;
            transition: 0.3s;
        }

            .sidenav a:hover {
                color: #f0b250;
            }

        .sidenav .closebtn {
            position: absolute;
            top: 0;
            right: 30px;
            font-size: 36px;
            margin-left: 50px;
            font-size: 50px;
        }

    #main {
        transition: margin-left .5s;
    }

    @@media screen and (max-height: 450px) {
        .sidenav {
            padding-top: 15px;
        }

            .sidenav a {
                font-size: 18px;
            }
    }

    .hide {
        display: none;
    }
</style>

<div class="container">
    <div>
        <div class="section-heading">
            <h2>Latest Products</h2>
            <a href="~/Products/Index">view all products <i class="fa fa-angle-right"></i></a>
        </div>
    </div>

    <br />
    <h3 id="category">@ViewBag.Categories</h3>
    <br />
    <br />

    <div style="width:100%; display:flex;justify-content:space-between; align-items:center">

        <div id="main">
            <div id="filter" style="cursor:pointer; color:#F0B250" onclick="openNav()">Filtreaza</div>
        </div>

        <div class="btn-group dropleft">
            <button id="sort" type="button" class="btn dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Sorteaza
            </button>
            <div class="dropdown-menu">
                <a class="dropdown-item" href="~/Products/Sort?Id=price">Pret crescator</a>
                <a class="dropdown-item" href="~/Products/Sort?Id=priceDesc">Pret descrescator</a>
                <a class="dropdown-item" href="~/Products/Sort?Id=name">Nume crescator</a>
                <a class="dropdown-item" href="~/Products/Sort?Id=nameDesc">Nume descrescator</a>
            </div>
        </div>
    </div>
    <br />

    @* filter menu*@

    <div id="mySidenav" class="sidenav">
        <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
        <br />
        <br />
        <br />
        <br />
        <div>
            <span> <a href="~/Products/FilterByCategory?Id=sport">Sportivi (@ViewBag.countSport)</a></span>
            <span> <a href="~/Products/FilterByCategory?Id=music">Muzicieni (@ViewBag.countMusic)</a></span>
            <span><a href="~/Products/FilterByCategory?Id=food">Înfometaţi (@ViewBag.countFood)</a></span>
            <span><a href="~/Products/FilterByCategory?Id=drink">Însetaţi (@ViewBag.countDrink)</a></span>
            <span><a href="~/Products/FilterByCategory?Id=travel">Călători (@ViewBag.countTravel)</a></span>
            <span><a href="~/Products/FilterByCategory?Id=hobby">Hobby (@ViewBag.countHobby)</a></span>
            <span><a href="~/Products/FilterByCategory?Id=job">Meseriași (@ViewBag.countJob)</a></span>
            <span><a href="~/Products/FilterByCategory?Id=business">Business (@ViewBag.countBusiness)</a></span>
            <span><a href="~/Products/FilterByCategory?Id=leather">Pipe & Leather (@ViewBag.countLeather)</a></span>
            <span><a href="~/Products/FilterByCategory?Id=twoBulbs">Două becuri (@ViewBag.countTwoBulbs)</a></span>
            <span><a href="~/Products/FilterByCategory?Id=other">Altele (@ViewBag.countOther)</a></span>
        </div>
    </div>


    <div class="row">
        @foreach (var lampEntity in Model)
        {
            <div class="col-lg-4 col-md-4 col-sm-6 col-6">
                <div class="product-item">
                    <a href="~/Products/Details?Id=@lampEntity.Id">
                        <img src="@lampEntity.MainImage" alt="">
                        <div class="down-content">
                            <h4 class="truncated-name" style="color:#212529">@lampEntity.Name</h4>
                            @if (!string.IsNullOrWhiteSpace(lampEntity.PriceReduced))
                            {
                                <div class="priceDiv" style="color:#212529"> <strike>Pret intreg: @lampEntity.Price RON </strike></div>
                                <div class="priceDiv" style="color:#212529">Pret redus: @lampEntity.PriceReduced RON</div>
                            }
                            else
                            {
                                <div class="priceDiv" style="color:#212529">@lampEntity.Price RON</div>
                            }

                            <form method="post" action="~/Cart/AddProduct">
                                <div style="margin-top: 15px">
                                    <input type="hidden" name="id" value="@lampEntity.Id" />
                                    <input type="hidden" name="quantity" value="1" />
                                    <input type="submit" class="btn shadow-none btn-cart-main submit" value="Adauga in cos" />
                                </div>
                            </form>

                        </div>
                    </a>
                </div>
            </div>
        }

    </div>
</div>

@*style for button "adauga in cos"*@
<style>
    .btn-cart-main {
        background: #212529;
        border-color: #212529;
        color: #fff;
        text-transform: uppercase;
        font-size: 1rem;
        height: 32px;
        line-height: 32px;
        padding: 0 24px;
        border-radius: 7px !important;
        transition: .4s ease-in-out;
        letter-spacing: 2px;
    }

        .btn-cart-main:hover {
            background: #F0B250;
            border-color: #F0B250;
            opacity: initial;
        }

        .btn-cart-main:focus {
            outline: none;
        }

    .product-item {
    }

        .product-item:hover {
            opacity: .8;
        }


    @@media (max-width: 767px) {
        .product-item .down-content h4 {
            margin-bottom: 10px;
            font-size: 12px;
        }

        .priceDiv {
            font-size: 14px;
        }

        .btn-cart-main {
            background: #212529;
            border-color: #212529;
            color: #fff;
            text-transform: uppercase;
            font-size: 12px;
            height: 28px;
            line-height: 22px;
            padding: 0 10px;
            border-radius: 7px !important;
            transition: .4s ease-in-out;
            letter-spacing: 1px;
        }

        .truncated-name {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    }
</style>

<script type="text/javascript"
        src="../node_modules/tw-elements/dist/js/tw-elements.umd.min.js">
</script>

<script>
    $(document).ready(function () {
        $('.truncated-name').each(function () {
            var spanElement = $(this).children('span');
            if (spanElement.get(0).scrollWidth > spanElement.innerWidth()) {
                $(this).addClass('tooltip');
                $(this).attr('title', spanElement.text());
            }
        });
    });

    //to do - move this code into master file
    const navItems = document.getElementsByClassName('nav-item');

    for (var i = 0; i < navItems.length; i++) {
        navItems[i].classList.remove('active');
        if (navItems[i].innerText == 'Produse') {
            navItems[i].classList.add('active');
        }
    }

    //ofcanvas logic

    function openNav() {
        function setNavWidth() {
            if (window.innerWidth < 768) {
                document.getElementById("mySidenav").style.width = "100vw";
                document.getElementById("main").style.marginLeft = "100vw";
                document.getElementById("filter").classList.add("hide");
                document.getElementById("sort").classList.add("hide");
            } else {
                document.getElementById("mySidenav").style.width = "30%";
                document.getElementById("main").style.marginLeft = "30%";
                document.getElementById("filter").classList.add("hide");
            }
        }

        setNavWidth(); // Initial setup

        window.addEventListener("resize", setNavWidth);
    }

    function closeNav() {
        document.getElementById("mySidenav").style.width = "0";
        document.getElementById("main").style.marginLeft = "0";
        document.getElementById("filter").classList.remove("hide");
        document.getElementById("sort").classList.remove("hide");
    }

    // Call openNav() to initialize the functionality
    openNav();


</script>
<script>
    //logic for displaying filters only on "Omuleti" page
    function hideMainIfNotOmuleti() {
        var categoryText = document.getElementById("category").innerText.trim();

        if (categoryText !== "Omuleti") {

            document.getElementById("main").style.visibility = "hidden";
        }
    }
    hideMainIfNotOmuleti();

</script>






